# go to
https://console.actions.google.com/
# create new project

#after naming the project and choosing ok, look at the bottom of the screen and choose Are you looking for device registration? Click here. This is the link in case it dissapears in the future. (https://console.actions.google.com/project/device_id/deviceregistration/). replace device id in the URL with your device id

#click register model, give it a name and make the device type, phone
#select any traits you like and download the client json file

# Enable the API (https://console.developers.google.com/apis/api/embeddedassistant.googleapis.com/overview)
# Make sure you have selected the right project in the console
# Click Enable
# Configure the OAuth consent screen (https://console.developers.google.com/apis/credentials/consent)
# Choose External and click create
# Choose the right support email and click Save

#Go to project settings and copy the Project ID
# Go to https://console.actions.google.com/ and choose the project
# Choose Develop and Choose Device Registration on the left
# Click on the table and copy the model id
# To download the OAuth file, click those three vertical dots on the extreme right of the product entry in the device registration table and choose the Download OAuth 2.0 credentials

sudo apt update && sudo apt upgrade
ifconfig
update-alternatives --remove python /usr/bin/python2
sudo update-alternatives --remove python /usr/bin/python2
update-alternatives --install /usr/bin/python python /usr/bin/python3 10
sudo update-alternatives --install /usr/bin/python python /usr/bin/python3 10
python #check python version
sudo apt-get update
sudo apt-get install python3-dev python3-venv
python3 -m venv env
env/bin/python -m pip install --upgrade pip setuptools wheel
source env/bin/activate
sudo apt-get install portaudio19-dev libffi-dev libssl-dev
python -m pip install --upgrade google-assistant-sdk[samples]
python -m pip install --upgrade google-auth-oauthlib[tool]

google-oauthlib-tool --scope https://www.googleapis.com/auth/assistant-sdk-prototype --save --headless --client-secrets paths_to_json_file
#replace paths_to_json_file with path to downloaded OAtuh file

# Click the link and when the browser opens, choose allow, copy the code and paste it back into the terminal

sudo apt install authbind
sudo touch /etc/authbind/byport/80
sudo chmod 777 /etc/authbind/byport/80
ifconfig 

source /home/nuc/env/bin/activate
pip install flask-assistant
#download ngrok
# run ngrok on authtoken
./ngrok authtoken 1dczhZcKKW1tXnILYvO4gZbVB9a_4GqJJ4mG6swftpT5mgBnL
#replace 1dczhZcKKW1tXnILYvO4gZbVB9a_4GqJJ4mG6swftpT5mgBnL with your authtoken

./ngrok http http://192.168.1.159:80

sensormain-8d0d9-sensormain-attzqg
sensormain-8d0d9

#specify right IP

#copy the URL and put it into the webhook in dialog flow

# if you paste the URL into the fulfilment tab of dialog flow and it gives 'Unexpected Error'
# refresh the page. Also when you click save, make sure you refresh the page to see if it actually saved the URL
#in case your go over the quota
# delete the file
rm .config/google-oauthlib-tool/credentials.json

# and do the setup below again
# go to
https://console.actions.google.com/
# create new project

#after naming the project and choosing ok, look at the bottom of the screen and choose Are you looking for device registration? Click here. This is the link in case it dissapears in the future. (https://console.actions.google.com/project/device_id/deviceregistration/). replace device id in the URL with your device id

#click register model, give it a name and make the device type, phone
#select any traits you like and download the client json file

# Enable the API (https://console.developers.google.com/apis/api/embeddedassistant.googleapis.com/overview)
# Make sure you have selected the right project in the console
# Click Enable
# Configure the OAuth consent screen (https://console.developers.google.com/apis/credentials/consent)
# Choose External and click create
# Choose the right support email and click Save

#Go to project settings and copy the Project ID

sensormain1

# Go to https://console.actions.google.com/ and choose the project
# Choose Develop and Choose Device Registration on the left
# Click on the table and copy the model id

sensormain1-sensormain1-qpwstx

# To download the OAuth file, click those three vertical dots on the extreme right of the product entry in the device registration table and choose the Download OAuth 2.0 credentials

# then do
google-oauthlib-tool --scope https://www.googleapis.com/auth/assistant-sdk-prototype --save --headless --client-secrets paths_to_json_file
#replace paths_to_json_file with path to downloaded OAtuh file

