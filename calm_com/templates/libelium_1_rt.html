<!DOCTYPE HTML>
<html>
<head>
<script type="text/javascript">
window.onload = function() {
	var temp_dataPoints = [];
	var pres_dataPoints = [];
	var hum_dataPoints 	= [];
	var lux_dataPoints 	= [];
	var lum_dataPoints 	= [];

	var temp_chart;
	var pres_chart;
	var hum_chart;
	var lux_chart;
	var lum_chart; 

	var temp_avg;
	var pres_avg;
	var hum_avg;
	var lux_avg;
	var lum_avg;

	var temp_max;
	var pres_max;
	var hum_max;
	var lux_max;
	var lum_max;

	var temp_min;
	var pres_min;
	var hum_min;
	var lux_min;
	var lum_min; 
	


	CanvasJS.addColorSet("red",["#8B0000"]); 
	CanvasJS.addColorSet("green",["#006400"]); 
	CanvasJS.addColorSet("indigo",["#4B0082"]); 
	CanvasJS.addColorSet("gold",["#DAA520"]);


	$.getJSON("http://10.0.0.35/l1_data", function(data) {  
		$.each(data[0], function(key, value){
			temp_dataPoints.push({label: value[0], y: parseFloat(value[1])});
		});
		$.each(data[1], function(key, value){
			pres_dataPoints.push({label: value[0], y: parseFloat(value[1])});
		});
		$.each(data[2], function(key, value){
			hum_dataPoints.push({label: value[0], y: parseFloat(value[1])});
		});
		$.each(data[3], function(key, value){
			lux_dataPoints.push({label: value[0], y: parseFloat(value[1])});
		});
		$.each(data[4], function(key, value){
			lum_dataPoints.push({label: value[0], y: parseFloat(value[1])});
		});

		temp_chart = new CanvasJS.Chart("tempChartContainer",{

			colorSet: "red",

			title:{
				text: "Temperature Data"
			},
			axisX:{
				title: "Time",
				gridThickness: 2
			},
			axisY: {
				title: "Temperature",
				includeZero: false 
			},
			data: [{
				type: "spline",
				dataPoints : temp_dataPoints,
			}]
		});

		pres_chart = new CanvasJS.Chart("presChartContainer",{
			title:{
				text: "Pressure Data"
			},
			axisX:{
				title: "Time",
				gridThickness: 2
			},
			axisY: {
				title: "Pressure",
				includeZero: false
			},
			data: [{
				type: "spline",
				dataPoints : pres_dataPoints,
			}]
		});

		hum_chart = new CanvasJS.Chart("humChartContainer",{
			
			colorSet: "green",

			title:{
				text: "Humidity Data"
			},
			axisX:{
				title: "Time",
				gridThickness: 2
			},
			axisY: {
				title: "Humidity",
				includeZero: false
			},
			data: [{
				type: "spline",
				dataPoints : hum_dataPoints,
			}]
		});

		lux_chart = new CanvasJS.Chart("luxChartContainer",{

			colorSet: "indigo",

			title:{
				text: "Illuminance Data"
			},
			axisX:{
				title: "Time",
				gridThickness: 2
			},
			axisY: {
				title: "Illuminance",
				includeZero: false
			},
			data: [{
				type: "spline",
				dataPoints : lux_dataPoints,
			}]
		});

		lum_chart = new CanvasJS.Chart("lumChartContainer",{

			colorSet: "gold",

			title:{
				text: "Luminosity Data"
			},
			axisX:{
				title: "Time",
				gridThickness: 2
			},
			axisY: {
				title: "Luminosity",
				includeZero: false
			},
			data: [{
				type: "spline",
				dataPoints : lum_dataPoints,
			}]
		});

		temp_chart.render();
		pres_chart.render();
		hum_chart.render();
		lux_chart.render();
		lum_chart.render();

		updateChart();
	});

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
	function get_average(datarray){
			total = 0;
			for(var i = 0; i < datarray.length; i++){
				total += datarray[i].y;
			}
			average = (total/datarray.length);
			return average; 
		}
	
	function get_min(datarray){
		datapoints = [];
		
		for (var i = 0; i < datarray.length; i++){
			datapoints.push(datarray[i].y);
		}

		minimum = Math.min(...datapoints);
		return minimum; 
	}

	function get_max(datarray){
		datapoints = [];
		
		for (var i = 0; i < datarray.length; i++){
			datapoints.push(datarray[i].y);
		}

		maximum = Math.max(...datapoints);
		return maximum; 
	}


////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

	function updateChart() {
	$.getJSON("http://10.0.0.35/l1_ltdata", function(data) {
		$.each(data[0], function(key, value) { 
			temp_dataPoints.push({
			label: value[0],
			y: parseFloat(value[1])
			});

			document.getElementById("max_temp").innerHTML = get_max(temp_dataPoints).toFixed(2); 
			document.getElementById("min_temp").innerHTML = get_min(temp_dataPoints).toFixed(2); 
			document.getElementById("avg_temp").innerHTML = get_average(temp_dataPoints).toFixed(2); 
			
			
		});

		$.each(data[1], function(key, value) { 
			pres_dataPoints.push({
			label: value[0],
			y: parseFloat(value[1])
			});

			document.getElementById("max_pres").innerHTML = get_max(pres_dataPoints).toFixed(2); 
			document.getElementById("min_pres").innerHTML = get_min(pres_dataPoints).toFixed(2); 
			document.getElementById("avg_pres").innerHTML = get_average(pres_dataPoints).toFixed(2); 
		});

		$.each(data[2], function(key, value) { 
			hum_dataPoints.push({
			label: value[0],
			y: parseFloat(value[1])
			});

			document.getElementById("max_hum").innerHTML = get_max(hum_dataPoints).toFixed(2); 
			document.getElementById("min_hum").innerHTML = get_min(hum_dataPoints).toFixed(2); 
			document.getElementById("avg_hum").innerHTML = get_average(hum_dataPoints).toFixed(2);
			
		});

		$.each(data[3], function(key, value) { 
			lux_dataPoints.push({
			label: value[0],
			y: parseFloat(value[1])
			});

			document.getElementById("max_lux").innerHTML = get_max(lux_dataPoints).toFixed(2); 
			document.getElementById("min_lux").innerHTML = get_min(lux_dataPoints).toFixed(2); 
			document.getElementById("avg_lux").innerHTML = get_average(lux_dataPoints).toFixed(2); 
			 
		});

		$.each(data[4], function(key, value) { 
			lum_dataPoints.push({
			label: value[0],
			y: parseFloat(value[1])
			}); 

			document.getElementById("max_lum").innerHTML = get_max(lum_dataPoints).toFixed(2); 
			document.getElementById("min_lum").innerHTML = get_min(lum_dataPoints).toFixed(2); 
			document.getElementById("avg_lum").innerHTML = get_average(lum_dataPoints).toFixed(2); 
		});

		temp_chart.render();
		pres_chart.render();
		hum_chart.render();
		lux_chart.render();
		lum_chart.render();

		setTimeout(function(){updateChart()}, 3000); 
	});
	}


}
</script>
<script type="text/javascript" src="https://canvasjs.com/assets/script/jquery-1.11.1.min.js"></script>
<script type="text/javascript" src="https://canvasjs.com/assets/script/canvasjs.min.js"></script>

<style>
	table, th, td {
		border: 1px solid black; 
	}
	th, td {
	padding: 15px;
	}
</style>

</head> 
	<body>
		<div>
			<h2>LIBELIUM SENSOR DATA</h2> 
			
			<table style="width:100%">
				<caption><h3>Data Statistics</h3></caption> 
				<tr>
					<th> </th>
					<th>Temperature</th>
					<th>Pressure</th> 
					<th>Humidity</th>
					<th>lux</th> 
					<th>lumen</th> 
				</tr>
				<tr>
					<th>Maximum</th>
					<td id="max_temp"></td>
					<td id="max_pres"></td>
					<td id="max_hum"></td>
					<td id="max_lux"></td>
					<td id="max_lum"></td> 
				</tr>
				<tr>
					<th>Minimum</th>
					<td id="min_temp"></td>
					<td id="min_pres"></td>
					<td id="min_hum"></td>
					<td id="min_lux"></td>
					<td id="min_lum"></td> 
				</tr>
				<tr>
					<th>Average</th> 
					<td id="avg_temp"></td>
					<td id="avg_pres"></td>
					<td id="avg_hum"></td>
					<td id="avg_lux"></td>
					<td id="avg_lum"></td> 
				</tr>
				
			</table>
				
		</div>
		<div id="tempChartContainer" style="height: 300px; width: 100%; margin-top: 50px"></div>
		<div id="presChartContainer" style="height: 300px; width: 100%; margin-top: 50px"></div>
		<div id="humChartContainer" style="height: 300px; width: 100%; margin-top: 50px"></div>
		<div id="luxChartContainer" style="height: 300px; width: 100%; margin-top: 50px"></div>
		<div id="lumChartContainer" style="height: 300px; width: 100%; margin-top: 50px"></div> 
	</body>
</html>
